# EdgeComment - 边缘留言板系统

<div align="center">

![ESA Declaration](https://img.alicdn.com/imgextra/i3/O1CN01H1UU3i1Cti9lYtFrs_!!6000000000139-2-tps-7534-844.png)

**本项目由阿里云ESA提供加速、计算和保护**

一个基于阿里云ESA边缘计算平台构建的无服务器留言板系统，让留言互动变得简单高效。

</div>

---

## 📋 项目介绍

EdgeComment是一个完全运行在边缘的留言板系统,充分利用阿里云ESA的边缘计算能力,实现了:

- **零后端部署** - 无需传统服务器,完全基于ESA边缘函数和EdgeKV
- **全球加速** - 依托ESA全球节点,留言提交和数据访问毫秒级响应
- **安全可靠** - JWT认证保护管理功能,SHA-256密码加密,数据安全存储在EdgeKV

### 🎯 三大评选维度亮点

#### 🎨 创意卓越
- **现代化留言界面** - 基于React 18 + TypeScript + Tailwind CSS构建
- **实时留言展示** - 所有访客可以实时查看留言内容
- **优雅的UI设计** - 深色主题,流畅动画,提供优秀的用户体验
- **Gravatar头像** - 自动显示用户Gravatar头像,提升视觉体验
- **响应式设计** - 完美适配桌面端和移动端

#### 💼 应用价值
- **开箱即用** - 部署后即可使用,无需复杂配置
- **广泛兼容** - 支持静态网站和动态网站低成本接入
  - 静态网站: Hugo、Jekyll、Hexo、VuePress等静态博客,只需嵌入一段代码即可拥有完整留言功能
  - 动态网站: WordPress、Django、Spring Boot等传统网站,无需改造后端,直接集成
  - 纯前端应用: React、Vue、Angular等SPA应用,天然适配
  - 接入成本: 仅需引入前端组件,无需部署后端服务器,零运维负担
- **真实场景应用** - 适用于网站留言、用户反馈、活动评论等多种场景
- **数据管理完善** - 支持留言查看、删除、点赞、排序等管理操作
- **零成本运营** - 基于ESA边缘计算,无需维护服务器,成本极低
- **全球可用** - 依托ESA全球节点,任何地区都能快速访问

#### 🔬 技术探索
- **完整的ESA生态应用** - 深度整合ESA Pages + 边缘函数 + EdgeKV
- **边缘计算最佳实践** - 展示了如何在边缘构建完整的留言板应用
- **无服务器架构** - 真正的Serverless,自动扩展,按需付费
- **现代前端技术栈** - React 18 + TypeScript + Vite + Tailwind CSS
- **安全认证机制** - JWT + SHA-256,企业级安全标准
- **EdgeKV操作优化** - 针对EdgeKV操作限制进行了深度优化

---

## ✨ 功能特性

### 留言功能
- 💬 支持昵称、邮箱、留言内容
- 📝 多行文本输入,支持换行,字数限制500字
- 🕐 自动记录留言时间
- 🌐 记录访客IP地址
- 🖼️ Gravatar头像集成 - 根据邮箱自动显示头像
- 👍 点赞功能 - 访客可以为喜欢的留言点赞
- 📊 实时统计 - 显示总评论数、总点赞数、最热评论

### 浏览与排序
- 🔄 多种排序方式:
  - 最新 - 按时间倒序显示最新留言
  - 最早 - 按时间正序显示最早留言
  - 最多点赞 - 按点赞数排序显示热门留言
- 📄 分页浏览 - 每页显示7条留言,支持上一页/下一页
- 📈 统计面板 - 实时显示评论数、点赞数、最热评论信息
- 📱 响应式布局 - 移动端和桌面端自适应

### 管理功能
- 🔐 JWT认证保护管理功能
- 🗑️ 管理员可删除不当留言
- 🔄 实时刷新留言列表
- 👤 管理员登录/登出
- 🔒 Token持久化 - 登录状态保存在localStorage

### 安全特性
- 🔒 密码哈希存储:SHA-256加密,安全可靠
- 🎫 JWT Token认证:7天有效期,自动过期保护
- 🚫 权限控制:留言提交公开,删除需认证
- 🛡️ CORS配置:支持跨域请求,安全可控
- 🔍 数据验证:前后端双重验证,防止恶意输入

---

## 🛠️ 技术栈

### 前端
- **React 18** - 现代化UI框架
- **TypeScript** - 类型安全
- **Vite** - 极速构建工具
- **Tailwind CSS** - 实用优先的CSS框架
- **Lucide React** - 现代化图标库

### 边缘计算
- **ESA Pages** - 静态资源托管和全球加速
- **ESA Edge Functions** - 边缘函数处理业务逻辑
  - `submit-comment` - 处理留言提交
  - `get-comments` - 获取留言列表(支持分页和排序)
  - `auth-comments` - 用户认证和JWT生成
  - `delete-comment` - 删除留言(需认证)
  - `like-comment` - 点赞留言
  - `get-stats` - 获取统计数据
  - `diagnose-comments` - 诊断工具(开发用)
- **EdgeKV** - 边缘键值存储
  - 存储留言数据
  - 存储留言ID列表
  - 存储管理员密码哈希
  - 存储JWT密钥

### 安全
- **Web Crypto API** - 密码哈希和JWT签名
- **JWT** - 无状态认证
- **HMAC-SHA256** - JWT签名算法

### EdgeKV操作优化
- **操作限制**: 每个Edge Function执行最多8次EdgeKV操作
- **分页策略**: 每页7条评论(1次读取列表 + 7次读取评论 = 8次操作)
- **统计优化**: 统计功能最多读取7条评论进行计算
- **错误处理**: 完善的错误处理和数据验证机制

---

## 🚀 快速开始

### 1. 克隆项目

```bash
git clone <repository-url>
cd edge-comment
```

### 2. 安装依赖

```bash
npm install
```

### 3. 本地开发

```bash
npm run dev
```

访问 http://localhost:5173

### 4. 构建项目

```bash
npm run build
```

### 5. 部署到ESA Pages

1. 将项目推送到GitHub
2. 登录[阿里云ESA控制台](https://esa.console.aliyun.com/)
3. 创建Pages项目,连接GitHub仓库
4. 配置构建命令:`npm run build`
5. 配置输出目录:`dist`
6. 部署完成

### 6. 配置Edge Functions

在ESA控制台创建以下Edge Functions:

#### submit-comment函数
- 代码:`functions/submit-comment/src/index.js`
- 路由:`/api/submit-comment`
- 功能:处理留言提交,验证数据,存储到EdgeKV

#### get-comments函数
- 代码:`functions/get-comments/src/index.js`
- 路由:`/api/get-comments`
- 功能:获取留言列表,支持分页和排序(newest/oldest/mostLiked)
- 参数:`?page=1&sort=newest`

#### auth-comments函数
- 代码:`functions/auth/src/index.js`
- 路由:`/api/auth-comments`
- 功能:管理员认证,生成JWT Token

#### delete-comment函数
- 代码:`functions/delete-comment/src/index.js`
- 路由:`/api/delete-comment`
- 功能:删除留言(需JWT认证)

#### like-comment函数
- 代码:`functions/like-comment/src/index.js`
- 路由:`/api/like-comment`
- 功能:为留言点赞,更新点赞计数

#### get-stats函数
- 代码:`functions/get-stats/src/index.js`
- 路由:`/api/get-stats`
- 功能:获取统计数据(总评论数、总点赞数、最热评论)

#### diagnose-comments函数(可选)
- 代码:`functions/diagnose-comments/src/index.js`
- 路由:`/api/diagnose-comments`
- 功能:诊断EdgeKV中的评论数据,检查数据完整性

### 7. 配置EdgeKV

1. 在ESA控制台创建EdgeKV命名空间:`edge-comment`
2. 打开 `setup-password.html` 生成密码哈希和JWT密钥
3. 在EdgeKV中添加以下键值对:
   - `admin_password_hash`: 你的密码哈希
   - `jwt_secret`: 生成的JWT密钥
   - `comments_list`: 空数组 `[]` (首次使用时自动创建)

---

## 📖 使用说明

### 提交留言

1. 访问网站
2. 输入昵称和留言内容(邮箱可选,填写后显示Gravatar头像)
3. 点击发送按钮
4. 留言会立即显示在列表中

### 浏览留言

1. 使用排序按钮切换显示顺序:
   - 最新 - 查看最新留言
   - 最早 - 查看最早留言
   - 最多点赞 - 查看热门留言
2. 使用分页按钮浏览更多留言
3. 查看统计面板了解整体数据

### 点赞留言

1. 点击留言下方的点赞按钮
2. 点赞数会立即更新
3. 每个访客可以多次点赞(基于localStorage记录)

### 管理留言

1. 在页面顶部输入管理员密码
2. 点击"登录"按钮
3. 登录后可以看到每条留言旁边的删除按钮
4. 点击删除按钮可以删除不当留言
5. 点击"登出"按钮退出管理模式

---

## 🏗️ 项目架构

```
edge-comment/
├── src/                      # 前端源码
│   ├── components/
│   │   ├── CommentBoard.tsx  # 主留言板组件
│   │   ├── CommentMessage.tsx # 单条留言组件
│   │   ├── CommentInput.tsx  # 留言输入组件
│   │   ├── CommentSkeleton.tsx # 加载骨架屏
│   │   ├── Toast.tsx         # 提示组件
│   │   └── StatsPanel.tsx    # 统计面板组件
│   ├── types/
│   │   └── comment.ts        # TypeScript类型定义
│   ├── App.tsx              # 主应用组件
│   └── main.tsx             # 入口文件
├── functions/               # Edge Functions
│   ├── submit-comment/      # 留言提交函数
│   ├── get-comments/        # 获取留言函数(支持分页和排序)
│   ├── auth/                # 认证函数
│   ├── delete-comment/      # 删除留言函数
│   ├── like-comment/        # 点赞函数
│   ├── get-stats/           # 统计数据函数
│   └── diagnose-comments/   # 诊断工具函数
├── setup-password.html      # 密码配置工具
├── esa.jsonc               # ESA配置文件
└── README.md               # 项目文档
```

---

## 🔒 安全说明

- 管理员密码使用SHA-256哈希存储,不存储明文
- JWT Token有效期7天,过期自动失效
- 删除接口需要JWT认证
- 留言提交接口公开,但记录IP地址
- 支持CORS,可配置允许的域名
- 前后端双重数据验证,防止XSS和注入攻击
- 点赞状态存储在localStorage,防止重复点赞

---

## 💰 成本估算

基于阿里云ESA的定价:

### EdgeKV费用标准
- **Read**: 0.7元/百万次
- **Write/Delete/List**: 6.5元/百万次
- **存储**: 0.1元/GB/天

### 边缘函数费用标准
- **免费版**: 10万次/天(适合个人和小型应用)
- **付费版**: 5.0元/百万次(适合中大型应用)

### 功能操作成本分析

每个功能的EdgeKV操作次数:

| 功能 | Read操作 | Write操作 | Delete操作 |
|------|---------|----------|-----------|
| 提交留言 | 1次(读取列表) | 2次(保存评论+更新列表) | 0 |
| 浏览留言(每页) | 8次(1次列表+7条评论) | 0 | 0 |
| 点赞留言 | 1次(读取评论) | 1次(更新评论) | 0 |
| 删除留言 | 2次(列表+评论) | 1次(更新列表) | 1次(删除评论) |
| 统计数据 | 8次(1次列表+7条评论) | 0 | 0 |
| 管理员认证 | 2次(密码哈希+JWT密钥) | 0 | 0 |

### 实际使用场景成本估算

#### 场景一: 小型个人网站
**日访问量**: 100次页面浏览, 10条新留言, 20次点赞

**EdgeKV操作统计:**
- 提交留言: 10 × (1读 + 2写) = 10读 + 20写
- 页面浏览: 100 × 8读 = 800读
- 点赞操作: 20 × (1读 + 1写) = 20读 + 20写
- 统计数据: 100 × 8读 = 800读
- 管理员认证: 2 × 2读 = 4读
- **总计**: 1,634读 + 40写

**费用计算:**
- Read费用: 1,634 × 0.7 / 1,000,000 = 0.0011元
- Write费用: 40 × 6.5 / 1,000,000 = 0.00026元
- 存储费用: <0.0001元(数据量极小)
- **每日费用**: 约0.0014元
- **每月费用**: 约0.042元

**边缘函数**: 约234次请求/天,使用免费版即可

---

#### 场景二: 中型社区网站
**日访问量**: 500次页面浏览, 50条新留言, 100次点赞, 5次删除

**EdgeKV操作统计:**
- 提交留言: 50 × (1读 + 2写) = 50读 + 100写
- 页面浏览: 500 × 8读 = 4,000读
- 点赞操作: 100 × (1读 + 1写) = 100读 + 100写
- 统计数据: 500 × 8读 = 4,000读
- 管理员认证: 5 × 2读 = 10读
- 删除留言: 5 × (2读 + 1写 + 1删) = 10读 + 5写 + 5删
- **总计**: 8,170读 + 205写 + 5删

**费用计算:**
- Read费用: 8,170 × 0.7 / 1,000,000 = 0.0057元
- Write/Delete费用: 210 × 6.5 / 1,000,000 = 0.0014元
- 存储费用: <0.0001元
- **每日费用**: 约0.0071元
- **每月费用**: 约0.21元

**边缘函数**: 约1,160次请求/天,使用免费版即可

---

#### 场景三: 大型活跃网站
**日访问量**: 1,000次页面浏览, 100条新留言, 200次点赞, 10次删除

**EdgeKV操作统计:**
- 提交留言: 100 × (1读 + 2写) = 100读 + 200写
- 页面浏览: 1,000 × 8读 = 8,000读
- 点赞操作: 200 × (1读 + 1写) = 200读 + 200写
- 统计数据: 1,000 × 8读 = 8,000读
- 管理员认证: 10 × 2读 = 20读
- 删除留言: 10 × (2读 + 1写 + 1删) = 20读 + 10写 + 10删
- **总计**: 16,340读 + 410写 + 10删

**费用计算:**
- Read费用: 16,340 × 0.7 / 1,000,000 = 0.0114元
- Write/Delete费用: 420 × 6.5 / 1,000,000 = 0.0027元
- 存储费用: <0.0001元
- **每日费用**: 约0.0141元
- **每月费用**: 约0.42元

**边缘函数**: 约2,320次请求/天,使用免费版即可

---

### 成本优势总结

- **极低成本**: 即使是大型活跃网站,每月成本也不到0.5元
- **免费额度充足**: 日均10万次以内的边缘函数请求完全免费
- **按需付费**: 只为实际使用的资源付费,无固定成本
- **无服务器维护**: 零运维成本,无需购买和维护服务器
- **全球加速**: 无需额外付费即可享受全球CDN加速

---

## 📊 性能优势

- **边缘计算** - 全球节点就近响应,延迟低至毫秒级
- **无服务器** - 自动扩展,无需担心并发压力
- **CDN加速** - 静态资源全球分发,加载速度极快
- **按需付费** - 只为实际使用付费,成本极低
- **智能优化** - 针对EdgeKV操作限制进行了深度优化

---

## 🗺️ 更新计划

### 即将推出的功能

#### 评论回复功能
- 支持对留言进行回复
- 显示回复层级关系
- 回复通知机制
- 回复数量统计

#### 评论审核功能
- 管理员审核模式
- 待审核留言队列
- 批量审核操作
- 审核历史记录
- 敏感词过滤

#### 其他计划功能
- 实时评论更新(轮询或WebSocket)
- 评论搜索功能
- 用户举报功能
- 评论导出功能
- 多语言支持

---

## 🏆 参赛信息

本项目参加**阿里云ESA Pages 边缘开发大赛**

### 项目亮点
- **创意卓越**: 现代化留言界面,实时展示,优雅的UI设计,Gravatar头像集成
- **应用价值**: 开箱即用,真实场景应用,零成本运营,完善的功能体系
- **技术探索**: 完整的ESA生态应用,边缘计算最佳实践,无服务器架构,EdgeKV操作优化

---

## 📄 开源协议

MIT License

---

## 👨‍💻 作者

基于阿里云ESA官方模板开发

---

## 🙏 致谢

感谢阿里云ESA团队提供的强大边缘计算平台和官方模板,让这个项目得以快速实现。

**本项目由阿里云ESA提供加速、计算和保护**
